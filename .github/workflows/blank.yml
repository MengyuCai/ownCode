name: æ¯å°æ—¶æ£€æŸ¥æ–‡ä»¶å˜åŠ¨å¹¶æ·»åŠ å†…å®¹

on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *'

jobs:
  check-and-update:
    runs-on: ubuntu-latest

    steps:
    - name: å®‰è£… jq å’Œ tac
      run: sudo apt-get install -y jq moreutils

    - name: å¤åˆ¶å¹¶ä¿®æ”¹æ–‡ä»¶
      id: modify-file
      run: |
        FILE_PATH="Clash/config/ACL4SSR_Online_Full_Netflix.ini"
        REPO="ACL4SSR/ACL4SSR"
        RAW_URL="https://raw.githubusercontent.com/${REPO}/master/${FILE_PATH}"

        # ä¸‹è½½æ–‡ä»¶
        curl -s -o file.ini "${RAW_URL}"

        # åœ¨ç¬¬ä¸€ä¸ªå‡ºç° "ruleset" çš„å…³é”®è¯å‰æ·»åŠ ä¸€è¡Œ
        awk '/ruleset/ && !modif { printf("ruleset=ä»£ç†è§„åˆ™,https://raw.githubusercontent.com/MengyuCai/ownCode/main/proxyCustomClashRules.list\n"); modif=1 } { print }' file.ini > newfile.ini
        
        # åœ¨ç¬¬ä¸€ä¸ªå‡ºç° "ruleset" çš„å…³é”®è¯å‰æ·»åŠ ä¸€è¡Œ
        awk '/ruleset/ && !modif { printf("ruleset=ç›´è¿è§„åˆ™,https://raw.githubusercontent.com/MengyuCai/ownCode/main/directCustomClashRules.list\n"); modif=1 } { print }' newfile.ini > file.ini

        # åœ¨ç¬¬6ä¸ªå‡ºç° "custom_proxy_group" çš„è¡Œå‰æ·»åŠ ä¸€è¡Œ
        awk 'BEGIN {count=0} /custom_proxy_group/ {count++} {if (count==6) printf("custom_proxy_group=ç›´è¿è§„åˆ™`select`[]REJECT`[]DIRECT\n"); print}' file.ini > newfile.ini
        
        # åœ¨ç¬¬7ä¸ªå‡ºç° "custom_proxy_group" çš„è¡Œå‰æ·»åŠ ä¸€è¡Œ
        awk 'BEGIN {count=0} /custom_proxy_group/ {count++} {if (count==7) printf("custom_proxy_group=ä»£ç†è§„åˆ™`select`[]ğŸš€ èŠ‚ç‚¹é€‰æ‹©`[]â™»ï¸ è‡ªåŠ¨é€‰æ‹©`[]ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹`[]ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹`[]ğŸ‡¨ğŸ‡³ å°æ¹¾èŠ‚ç‚¹`[]ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹`[]ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹`[]ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹`[]ğŸš€ æ‰‹åŠ¨åˆ‡æ¢`[]DIRECT\n"); print}' newfile.ini > file.ini
        
        # åœ¨ç¬¬ä¸€ä¸ªå‡ºç° "ruleset" çš„å…³é”®è¯å‰æ·»åŠ ä¸€è¡Œ
        awk '/ruleset=ğŸ’¬ OpenAi/ && !modif { printf("ruleset=ğŸ’¬ OpenAi,https://raw.githubusercontent.com/wgetnz/chatgpt-openclash/main/chatgpt.list\n"); modif=1 } { print }' file.ini > newfile.ini
        

        # æ‰“å°æ–‡ä»¶å†…å®¹
        cat newfile.ini
